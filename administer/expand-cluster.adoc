---
sidebar: sidebar
permalink: administer/expand-cluster.html
keywords: afx, afx system, expansion, cluster expansion, expand cluster, add nodes
summary: "You can expand the compute capacity of an AFX cluster independent of the storage capacity. The expansion is performed without disruption and increases performance linearly as volumes are rebalanced across the nodes. This feature is a significant benefit as you adjust to the ongoing needs of your AFX users."
---
= Expand an AFX storage system cluster
:icons: font
:imagesdir: ../media/

[.lead]
You can expand the compute capacity of an AFX cluster independent of the storage capacity. The expansion is performed without disruption and increases performance linearly as volumes are rebalanced across the nodes. This feature is a significant benefit as you adjust to the ongoing needs of your AFX system users.

== Prepare to expand a cluster

Before expanding an AFX cluster, you should be familiar with the basic requirements and general approach to troubleshooting.

=== Requirements

You need the credentials for a cluster administrator account and be able to connect to the ONTAP CLI using SSH. When expanding a cluster, you must add an even number of nodes and adhere to the size limitations of your AFX system based on the release.

=== Troubleshooting

There are a few concepts and troubleshooting scenarios you should be aware of as you perform the cluster expansion.

==== Automatic volume rebalancing

Automated Topology Management (ATM) is in internal AFX system component that detects allocation imbalances and rebalances volumes across the cluster nodes. It relies on the Zero Copy Volume Move (ZCVM) technology to relocate volumes using metadata updates instead of copying the data. ZCVM is the default volume move technology available with AFX storage systems.

==== Possible troubleshooting scenarios

There are several scenarios you might need to investigate during the volume moves associated with the expansion of an AFX cluster.

Volumes are not being moved by ATM::
This can occur when the cluster is already in balance or when there are no eligible volumes to move.

Confusion about how or when ATM should be active::
It may appear that volumes aren't distributed as quickly as expected. ATM attempts to detect and respond to hardware events every five minutes. In the worst case, a rebalance operation is launched 40 minutes after the last one completed.

==== CLI commands

There are several commands you can use to monitor a cluster expansion operation.

* `volume move show`
* `volume move show -instance`

You should contact NetApp support for additional assistance as needed.

== Add nodes to expand a cluster

This procedure describes how to add a pair of nodes to an existing cluster and can be adapted to other deployment environments. You'll need to use both the ONTAP CLI and System Manager administrative interfaces.

.Steps

. Connect to the ONTAP CLI and set advanced privilege level:
+
`afx> set advanced`

. Display the volume locations of the current nodes; note the number of volumes per node:
+
`afx> vol show -fields node,size,constituent-count -is-constituent true -node *`

. Display the cluster interconnect IP addresses and save for use in later steps:
+
`afx> net int show -role cluster`

. Log into the service processor of each node you wish to add to the cluster.

. From the prompt, type *system console* to access the nodeâ€™s console.

. Boot the node to display the boot menu prompt:
+
`LOADER> boot_ontap menu`
+
If the menu does not load, use the *Ctrl+C* technique to access the boot menu.

. Select one of the boot options from the menu as appropriate; if prompted type *yes* to continue.
+
If you get sent back to LOADER from here, type *boot_ontap* at the LOADER prompt.

. Use the cluster setup wizard to configure a node management LIF, subnet, and gateway.
+
This configuration will be used by System Manager to detect the node to be added to the cluster. Enter the values as prompted, including port, IP address, netmask, and default gateway.

. Press *CTL+C* to access the CLI.

. Modify the cluster interconnect addresses so they're routable in your network; use the configuration appropriate for your environment:
+
`afx> net int show -role cluster`
+
`afx> net int modify -vserver Cluster -lif clus1 -address 192.168.100.201`
+
`afx> net int modify -vserver Cluster -lif clus2 -address 192.168.100.202`
+
This step is only needed if the other interfaces do not use the 169.254.x.x addresses that ONTAP auto creates.

. Repeat the above steps on the other AFX node controller.

. Access the System Manager using the cluster management IP address.

. In System Manager, select *Cluster* and then *Overview*; select the *Nodes* tab.

. Locate the section *Not part of this cluster*; select image:icon_add_blue_bg.png[blue rectangle containing a plus sign followed by the word add in white letters].
+
* If the nodes were discovered before the cluster interconnect IP addresses are changed, you'll need to re-discover the nodes by exiting the window and navigating back.
* You can optionally use the CLI to add the nodes instead of System Manager; see the command `cluster add-node`.

. Provide the configuration details in the *Add nodes* menu; you can add management IP addresses manually or using a subnet.

. Connect to the ONTAP CLI to monitor the status of the node add operation:
+
`afx> add-node-status`

. After the operations have completed, confirm the volume placement across all nodes; issue the command once for each node using the appropriate node name:
+
`afx> set advanced`
+
`afx> vol show -fields node,size,constituent-count -is-constituent true -node NODE_NAME`

.Result

* Adding new nodes to the cluster is nondisruptive.
* Volume moves should happen automatically.
* Performance will scale linearly.

== Related information

* link:../get-started/prepare-cluster-admin.html[Prepare to administer your AFX system]
* link:../faq-ontap-afx.html[FAQ for ONTAP AFX storage systems]
* https://mysupport.netapp.com/[NetApp Support Site^]
