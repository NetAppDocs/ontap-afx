---
sidebar: sidebar
permalink: protect-data/manage-consistency-groups.html
keywords: 
summary: 
---
= Manage consistency groups on ONTAP AFX
:icons: font
:imagesdir: ../media/

[.lead]
A consistency group is a collection of volumes managed as a single unit. For example, suppose you have an application that uses related data spread over five volumes. Instead of backing up each volume separately, you can back up all the volumes by adding snapshot protection to a single consistency group.

Hierarchical consistency groups were added with ONTAP 9.16.1 and are available with ONTAP AFX. With a hierarchical structure, one or more consistency groups can be configured as children under a parent consistency group. These hierarchical groups allow you to apply individual snapshot policies to child consistency groups and replicate the snapshots of all the child consistency groups to a remote cluster as a single unit by replicating the parent.  This simplifies data protection and management for complex data structures.

== Add snapshot data protection to a consistency group

When you add snapshot data protection to a consistency group, local snapshots of the consistency group can be taken at regular intervals based on a pre-defined schedule. 

.Steps

. In System Manager, select *Protection* and then *Consistency groups*.
. Hover over the consistency group you want to protect.
. Select image:icon_kabob.gif[three vertical blue dots]; then select *Edit*.
. Under *Local protection*, select *Schedule snapshots*.
. Select a snapshot policy.
+
Accept the default snapshot policy, select an existing policy, or create a new policy.
+
[cols="2,6a" options="header"]
|===
// header row
| Option
| Steps

| Select an existing snapshot policy
a| Select image:icon_dropdown_arrow.gif[downward pointing blue arrow] next to the default policy; then select the existing policy that you want to use.

| Create a new snapshot policy
a|
.. Select image:icon_add.gif[blue plus sign followed by the word add]; then enter the new policy name.
.. Select the policy scope.
.. Under *Schedules* select image:icon_add.gif[blue plus sign followed by the word add].
.. Select the name that appears under *Schedule name*; 
+
then select image:icon_dropdown_arrow.gif[blue arrow pointing in downward direction].
.. Select the policy schedule.
.. Under *Maximum snapshots*, enter the maximum number of snapshots that you want to retain of the consistency group.
.. Optionally, under *SnapMirror label* enter a SnapMirror label.
.. Select *Save*.

// table end
|===

. Select *Edit*.

== Remove snapshot data protection from a consistency group

When you remove snapshot data protection from a consistency group, snapshots are disabled for all the volumes in the consistency group. 

.Steps
. In System Manager, select *Protection* and then *Consistency groups*.
. Hover over the consistency group you want to stop protecting.
. Select image:icon_kabob.gif[three vertical blue dots]; then select *Edit*.
. Under *Local protection*, deselect Schedule snapshots.
. Select *Edit*.

.Result

Snapshots will not be taken for the volumes in the consistency group.

== Add volumes to a consistency group

Expand the amount of storage managed by a consistency group by adding volumes to the consistency group.

You can add existing volumes to your consistency group or you can create new volumes for the consistency group.

// start tabbed area

[role="tabbed-block"]
====

.Add existing volumes
--
.Steps

. In System Manager, select *Protection* and then *Consistency groups*.
. Hover over the consistency group you want to expand.
. Select image:icon_kabob.gif[three vertical blue dots]; then select *Expand*.
. Select *Using existing volumes*.
. Select the volumes to add to the consistency group; then select *Expand*.
--

.Add new volumes
--
.Steps

. In System Manager, select *Protection* and then *Consistency groups*.
. Hover over the consistency group you want to expand.
. Select image:icon_kabob.gif[three vertical blue dots]; then select *Expand*.
. Select *Using new volumes*.
. Enter the number of volumes you want to create and the capacity per unit.
+
If you create more that one unit, each unit is created with the same capacity and the same host operating system.  To assign a different capacity to each unit, select *Add a different capacity* to assign a different capacity to each unit.
. Select *Expand*.

--

====

// end tabbed area

.What's next?
Existing snapshots of the consistency group won't include your newly added volumes.  You should link:create-snapshots.html#step-2-create-a-snapshot[create an immediate snapshot] of your consistency group to protect your newly added volumes until the next scheduled snapshot is automatically created.

== Remove a storage unit from a consistency group
You should remove a storage unit from a consistency group if you want to delete the storage unit, if you want manage it as part of a different consistency group, or if you no longer need to protect the data it contains. Removing a storage unit from a consistency group breaks the relationship between the storage unit and the consistency group, but does not delete the storage unit.  

.Steps

. In System Manager, select *Protection* and then *Consistency groups*.
. Double-click the consistency group from which you want to remove a storage unit.
. In the *Overview* section, under *Volumes*, select the storage unit you want to remove; then select *Remove from consistency group*.

.Result
The storage unit is no longer a member of the consistency group.

.What's next
If you need to continue data protection for the storage unit, add the storage unit to another consistency group.

== Convert an existing consistency group into a parent consistency group

Volumes cannot be directly associated with a parent consistency group.  If you convert an existing consistency group to a parent, a new child consistency group is created and the volumes belonging to the converted consistency group are moved to the new child consistency group.  

.Steps

. In System Manager, select *Protection* and then *Consistency groups*.
. Hover over the consistency group you want convert into a parent consistency group.
. Select image:icon_kabob.gif[three vertical blue dots]; then select *Promote to parent consistency group*.
. Enter a name for the parent consistency group or accept the default name; then select the consistency group component type.
. Select *Promote*.

.What's next?
You can create additional child consistency groups under the parent consistency group.  You can also link:../secure-data/encrypt-data-at-rest.html[set up snapshot replication] to copy the parent consistency group to a geographically remote location for backup and disaster recovery.

== Create a child consistency group

Creating child consistency groups allows you to apply individual snapshot policies to each child while applying a replication policy to all the child consistency groups at the parent level. 

You can create a child consistency group from a new or existing consistency group.  

// start tabbed area

[role="tabbed-block"]
====

.From a new consistency group
--

.Steps

. In System Manager, select *Protection* and then *Consistency groups*.
. Hover over the parent consistency group you want to add a child consistency group to.
. Select image:icon_kabob.gif[three vertical blue dots]; then select *Add a new child consistency group*.
. Enter a name for the child consistency group or accept the default name; then select the consistency group component type.    
. Select to add existing volumes to the child consistency group or to create a new volume.
+
If you create new volumes, provide the configuration data.
+
If you create more than one storage unit, each unit is created with the same capacity and the same host operating system. To assign a different capacity to each unit, select *Add a different capacity*.
. Select *Add*.
--

.From an existing consistency group
--
.Steps
. In System Manager, select *Protection* and then *Consistency groups*.
. Select the existing consistency group that you would like to make a child consistency group.
. Select image:icon_kabob.gif[three vertical blue dots]; then select *Move under different consistency group*.
+
If the consistency group you would like to use as already the child of another consistency group, you must detach it from the existing parent consistency group before you can move it to a new parent consistency group.
. Enter a new name for the child consistency group or accept the default name; then select the consistency group component type.
. Select the existing consistency group that you would like to make the parent consistency group or select to create a new parent consistency group.
+
If you select to create a new parent consistency group, enter a name for the parent consistency group or accept the default name; then select the consistency application component type.
. Select *Move*.
--
====

// end tabbed area

.What's next
After you create a child consistency group, you can link:policies-schedules.html#apply-a-snapshot-policy-to-a-consistency-group[apply individual snapshot protection policies] to each child consistency group. You can also link:snapshot-replication.html[set up a replication policy] on the parent consistency group to replicate the snapshots of all the child consistency groups to a remote cluster as a single unit.


== Demote a parent consistency group to a single consistency group

When you _demote_ a parent consistency group to a single consistency group, the volumes of the associated child consistency groups are added to the parent consistency group.  The child consistency groups are deleted and the parent is then managed as a single consistency group.

.Steps 

. In System Manager, select *Protection* and then *Consistency groups*.
. Hover over the parent consistency group you want to demote.
. Select image:icon_kabob.gif[three vertical blue dots]; then select *Demote to a single consistency group*.
. Select *Demote*

.What's next?

link:policies-schedules.html#apply-a-snapshot-policy-to-a-consistency-group[Add a snapshot policy] to the demoted consistency group to protect the volumes that were previously managed by the child consistency groups.

== Detach a child consistency group from a parent consistency group

When you detach a child consistency group from a parent consistency group, the child consistency group is removed from the parent consistency group and is managed as a single consistency group. The replication policy applied to the parent are no longer applied to the detached child consistency group.

.Steps

. In System Manager, select *Protection* and then *Consistency groups*.
. Select the parent consistency group.
. Select over the child consistency group you want to detach.
. Select image:icon_kabob.gif[three vertical blue dots]; then select *Detach from parent*.
. Enter a new name for the consistency group you are detaching or accept the default name; then select the consistency group application type.
. Select *Detach*.

.What's next?

link:snapshot-replication.html[Set up a replication policy] to replicate the snapshots of the detached child consistency group to a remote cluster as a single consistency group.

== Delete a consistency group

If you no longer need to manage the members of a consistency group as a single unit, you can delete the consistency group.  After a consistency group is deleted, the volumes previously in the group remain active on the cluster.

.Before you begin
If the consistency group you want to delete is in a replication relationship, you must break the relationship before you delete the consistency group. After you delete a replication consistency group, the volumes that were in the consistency group remain active on the cluster and their replicated copies remain on the remote cluster.


.Steps
. In System Manager, select *Protection* and then *Consistency groups*.
. Hover over the consistency group you want to delete.
. Select image:icon_kabob.gif[three vertical blue dots]; then select *Delete*.
. Accept the warning, then select *Delete*.

.What's next?

After you delete a consistency group, the volumes previously in the consistency group are no longer protected by snapshots.  Consider adding these volumes to another consistency group to protect them against data loss.
